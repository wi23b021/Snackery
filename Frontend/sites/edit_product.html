<!-- 
    Snackery – Produkt bearbeiten (edit_product.html)
    Diese Seite erlaubt Admins, bestehende Produkte zu bearbeiten.
    Technologien: HTML5, CSS, JavaScript (AJAX)
-->

<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <title>Produkt bearbeiten – Snackery</title>

    <!-- Stylesheet -->
    <link rel="stylesheet" href="../res/css/style.css">
</head>

<body>

    <!-- ==================== HEADER ==================== -->
    <header>
        <div class="logo">
            <a href="/Snackery/index.html">
                <img src="../res/img/snackery-logo.jpg" alt="Snackery Logo">
            </a>
        </div>

        <!-- Navigation -->
        <nav>
            <ul>
                <li><a href="/Snackery/index.html">Startseite</a></li>
                <li><a href="admin_products.html">Zurück</a></li>
            </ul>
        </nav>
    </header>

    <!-- ==================== PRODUKT BEARBEITEN ==================== -->
    <main>
        <div class="register-container">
            <h2>Produkt bearbeiten</h2>

            <!-- Formular für Produktdaten -->
            <form id="editProductForm">
                <input type="text" id="name" placeholder="Produktname" required>
                <input type="number" step="0.01" id="price" placeholder="Preis (€)" required>
                <input type="text" id="category" placeholder="Kategorie" required>

                <button type="submit">Speichern</button>
            </form>
        </div>
    </main>

    <!-- ==================== JAVASCRIPT ==================== -->
    <script>
        // Produkt-ID aus URL auslesen
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');

        if (!productId) {
            // Keine ID vorhanden → zurück zur Produktliste
            window.location.href = 'admin_products.html';
        }

        // Produktdetails laden
        fetch(`../../Backend/logic/requestHandler.php?action=getProduct&id=${productId}`)
            .then(response => {
                if (!response.ok) throw new Error("Netzwerkfehler");
                return response.json();
            })
            .then(product => {
                // Felder im Formular befüllen
                document.getElementById('name').value = product.name;
                document.getElementById('price').value = product.price;
                document.getElementById('category').value = product.category;
            })
            .catch(error => {
                alert("❌ Fehler beim Laden des Produkts.");
                console.error(error);
                window.location.href = "admin_products.html";
            });

        // Formular absenden → Produkt aktualisieren
        document.getElementById("editProductForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const updatedProduct = {
                name: document.getElementById("name").value,
                price: document.getElementById("price").value,
                category: document.getElementById("category").value
            };

            fetch(`../../Backend/logic/requestHandler.php?action=updateProduct&id=${productId}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(updatedProduct)
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        alert("✅ Produkt erfolgreich aktualisiert!");
                        window.location.href = "admin_products.html";
                    } else {
                        alert("❌ Fehler beim Speichern.");
                    }
                })
                .catch(error => {
                    alert("❌ Serverfehler beim Speichern.");
                    console.error(error);
                });
        });
    </script>

</body>

</html>