<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <title>Produkt bearbeiten – Snackery</title>
    <link rel="stylesheet" href="../res/css/style.css">
    <script src="../res/js/session-check.js" defer></script>
</head>

<body>

    <!-- ==================== HEADER ==================== -->
    <header>
        <div class="logo">
            <a href="/Snackery/index.html">
                <img src="../res/img/snackery-logo.jpg" alt="Snackery Logo">
            </a>
        </div>
        <nav>
            <ul>
                <li><a href="/Snackery/index.html">Startseite</a></li>
                <li><a href="admin_products.html">Zurück</a></li>
                <li><a href="../../Backend/logout.php">Logout</a></li>
            </ul>
        </nav>
    </header>

    <!-- ==================== PRODUKT BEARBEITEN ==================== -->
    <main>
        <div class="register-container">
            <h2>Produkt bearbeiten</h2>

            <!-- Formular für Produktdaten -->
            <form id="editProductForm">
                <input type="text" id="name" placeholder="Produktname" required>
                <input type="number" step="0.01" id="price" placeholder="Preis (€)" required>
                <input type="text" id="category" placeholder="Kategorie" required>

                <button type="submit">Speichern</button>
            </form>

            <p id="feedback" style="margin-top: 20px; font-weight: bold;"></p>
        </div>
    </main>

    <!-- ==================== JAVASCRIPT ==================== -->
    <script>
        const productId = new URLSearchParams(window.location.search).get('id');

        if (!productId) {
            alert("❌ Keine Produkt-ID gefunden.");
            window.location.href = "admin_products.html";
        }

        // Produktdaten laden
        fetch(`../../Backend/logic/requestHandler.php?action=getProduct&id=${productId}`, {
                credentials: "include"
            })
            .then(response => response.json())
            .then(product => {
                if (!product || !product.id) {
                    alert("❌ Produkt nicht gefunden.");
                    window.location.href = "admin_products.html";
                    return;
                }

                document.getElementById('name').value = product.name;
                document.getElementById('price').value = product.price;
                document.getElementById('category').value = product.category;
            })
            .catch(error => {
                alert("❌ Fehler beim Laden des Produkts.");
                console.error(error);
                window.location.href = "admin_products.html";
            });

        // Formular absenden
        document.getElementById("editProductForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const updatedProduct = {
                name: document.getElementById("name").value.trim(),
                price: parseFloat(document.getElementById("price").value),
                category: document.getElementById("category").value.trim()
            };

            fetch(`../../Backend/logic/requestHandler.php?action=updateProduct&id=${productId}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(updatedProduct),
                    credentials: "include"
                })
                .then(response => response.json())
                .then(result => {
                    const feedback = document.getElementById("feedback");
                    feedback.textContent = result.success ? "✅ Produkt erfolgreich gespeichert!" : "❌ " + (result.message || "Fehler beim Speichern.");
                    feedback.style.color = result.success ? "green" : "red";

                    if (result.success) {
                        setTimeout(() => window.location.href = "admin_products.html", 2000);
                    }
                })
                .catch(error => {
                    console.error("❌ Serverfehler:", error);
                    document.getElementById("feedback").textContent = "❌ Fehler beim Senden.";
                    document.getElementById("feedback").style.color = "red";
                });
        });
    </script>

</body>

</html>