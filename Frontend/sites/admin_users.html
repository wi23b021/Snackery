<!-- 
    Snackery ‚Äì Benutzerverwaltung (admin_users.html)
    Diese Seite zeigt alle registrierten Benutzer f√ºr Admins an.
    Technologien: HTML5, CSS, JavaScript (AJAX)
-->

<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <title>Admin ‚Äì Benutzerverwaltung</title>

    <!-- Einbinden des globalen Stylesheets -->
    <link rel="stylesheet" href="../res/css/style.css">
</head>

<body>

    <!-- ==================== HEADER ==================== -->
    <header>
        <div class="logo">
            <a href="/Snackery/index.html">
                <img src="../res/img/snackery-logo.jpg" alt="Snackery Logo">
            </a>
        </div>

        <!-- Navigation -->
        <nav>
            <ul>
                <li><a href="/Snackery/index.html">Startseite</a></li>
                <li><a href="products.html">Produkte</a></li>
                <li><a href="cart.html">Warenkorb</a></li>
                <li><a href="admin.html">Adminbereich</a></li>
                <li><a href="profil.html">Mein Profil</a></li>
                <li><a href="login.html">Logout</a></li>
            </ul>
        </nav>
    </header>

    <!-- ==================== BENUTZERVERWALTUNG ==================== -->
    <main class="admin-container">
        <h2>Benutzer verwalten</h2>

        <!-- Bereich, wo die Benutzertabelle geladen wird -->
        <div id="userTableContainer">
            <p>üîÑ Lade Benutzerliste...</p>
        </div>
    </main>

    <!-- ==================== FOOTER ==================== -->
    <footer>
        <div class="footer-content">
            <p>&copy; 2025 Snackery</p>
            <div class="footer-links">
                <a href="impressum.html">Impressum</a>
                <a href="hilfe.html">Hilfe</a>
            </div>
        </div>
    </footer>

    <!-- ==================== JAVASCRIPT: BENUTZER LADEN ==================== -->
    <script>
        // AJAX-Request zum Laden der Benutzer
        fetch("../../Backend/logic/requestHandler.php?action=getUsers")
            .then(response => response.json())
            .then(users => {
                const container = document.getElementById("userTableContainer");

                if (!Array.isArray(users)) {
                    container.innerHTML = "<p>‚ùå Fehler beim Laden der Benutzerliste.</p>";
                    console.error(users);
                    return;
                }

                if (users.length === 0) {
                    container.innerHTML = "<p>Keine Benutzer vorhanden.</p>";
                    return;
                }

                // Tabelle erzeugen
                let tableHTML = `
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Benutzername</th>
                                <th>E-Mail</th>
                                <th>Vorname</th>
                                <th>Nachname</th>
                                <th>Rolle</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody>`;

                users.forEach(user => {
                    tableHTML += `
                        <tr>
                            <td>${user.id}</td>
                            <td>${user.username}</td>
                            <td>${user.email}</td>
                            <td>${user.firstname}</td>
                            <td>${user.lastname}</td>
                            <td>
                                <select data-user-id="${user.id}" class="roleSelect">
                                    <option value="user" ${user.role === "user" ? "selected" : ""}>User</option>
                                    <option value="admin" ${user.role === "admin" ? "selected" : ""}>Admin</option>
                                </select>
                            </td>
                            <td>
                                <button class="deleteUserBtn" data-user-id="${user.id}">L√∂schen</button>
                            </td>
                        </tr>`;
                });

                tableHTML += "</tbody></table>";
                container.innerHTML = tableHTML;

                // Rollenauswahl (√Ñnderung)
                document.querySelectorAll(".roleSelect").forEach(select => {
                    select.addEventListener("change", function() {
                        const userId = this.dataset.userId;
                        const newRole = this.value;
                        alert(`üîÑ Rolle von Benutzer ${userId} ge√§ndert zu ${newRole} (noch nicht gespeichert).`);
                    });
                });

                // Benutzer l√∂schen (nur Simulation hier)
                document.querySelectorAll(".deleteUserBtn").forEach(btn => {
                    btn.addEventListener("click", function() {
                        const userId = this.dataset.userId;
                        if (confirm("‚ùó Benutzer wirklich l√∂schen?")) {
                            alert(`üóëÔ∏è Benutzer ${userId} l√∂schen (Aktion an Backend senden).`);
                        }
                    });
                });

            })
            .catch(error => {
                document.getElementById("userTableContainer").innerHTML = "<p>‚ùå Fehler beim Laden der Benutzer.</p>";
                console.error(error);
            });
    </script>

</body>

</html>