<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <title>Admin ‚Äì Bestellungen verwalten</title>

    <!-- üé® Globale CSS-Datei einbinden -->
    <link rel="stylesheet" href="../res/css/style.css">

    <!-- üîí Session-√úberpr√ºfung (nur eingeloggte Admins d√ºrfen hierher) -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            fetch("../../Backend/logic/sessionStatus.php", {
                    credentials: "include" // Cookie mitsenden f√ºr Sessionpr√ºfung
                })
                .then(response => response.json())
                .then(data => {
                    if (!data.loggedIn || data.role !== "admin") {
                        // ‚ùå Falls nicht eingeloggt oder kein Admin ‚Üí Weiterleitung
                        window.location.href = "login.html";
                    }
                })
                .catch(error => {
                    console.error("Fehler beim Session-Check:", error);
                    window.location.href = "login.html";
                });
        });
    </script>
</head>

<body>

    <!-- ==================== HEADER ==================== -->
    <header>
        <div class="logo">
            <!-- Klick auf Logo f√ºhrt zur√ºck zur Startseite -->
            <a href="/Snackery/index.html">
                <img src="../res/img/snackery-logo.jpg" alt="Snackery Logo">
            </a>
        </div>

        <!-- Navigation nur f√ºr Admins -->
        <nav>
            <ul>
                <li><a href="/Snackery/index.html">Startseite</a></li>
                <li><a href="admin_products.html">Produkte</a></li>
                <li><a href="admin_orders.html">Bestellungen</a></li>
                <li><a href="admin_users.html">Benutzer</a></li>
                <li><a href="../../Backend/logout.php">Logout</a></li>
            </ul>
        </nav>
    </header>

    <!-- ==================== BESTELL√úBERSICHT ==================== -->
    <main style="padding: 40px;">
        <h2>Bestellungen verwalten</h2>

        <!-- Bereich f√ºr dynamisch geladene Bestellungen -->
        <div id="orderTableContainer">
            <p>üîÑ Bestellungen werden geladen...</p>
        </div>
    </main>

    <!-- ==================== FOOTER ==================== -->
    <footer>
        <div class="footer-content">
            <p>&copy; 2025 Snackery</p>
            <div class="footer-links">
                <a href="impressum.html">Impressum</a>
                <a href="hilfe.html">Hilfe</a>
            </div>
        </div>
    </footer>

    <!-- ==================== JAVASCRIPT: BESTELLUNGEN LADEN ==================== -->
    <script>
        // üì¶ AJAX-Request an Backend zum Abrufen der Bestellungen
        fetch("../../Backend/logic/requestHandler.php?action=getOrders", {
                credentials: "include" // Session-Cookie mitsenden
            })
            .then(response => response.json())
            .then(orders => {
                const container = document.getElementById("orderTableContainer");

                if (orders.length === 0) {
                    container.innerHTML = "<p>‚ùå Es wurden noch keine Bestellungen aufgegeben.</p>";
                    return;
                }

                // üìã Tabelle f√ºr Bestellungen aufbauen
                let tableHTML = `
                <table border="1" cellpadding="10" cellspacing="0" style="width:100%; background-color: white;">
                    <thead>
                        <tr>
                            <th>Bestell-ID</th>
                            <th>Benutzer-ID</th>
                            <th>Datum</th>
                            <th>Status</th>
                            <th>Aktion</th>
                        </tr>
                    </thead>
                    <tbody>`;

                orders.forEach(order => {
                    tableHTML += `
                    <tr>
                        <td>${order.id}</td>
                        <td>${order.user_id}</td>
                        <td>${order.order_date}</td>
                        <td>${order.status}</td>
                        <td>
                            <a class="btn" href="edit_order.html?id=${order.id}">Bearbeiten</a>
                        </td>
                    </tr>`;
                });

                tableHTML += "</tbody></table>";
                container.innerHTML = tableHTML;
            })
            .catch(error => {
                console.error("‚ùå Fehler beim Laden der Bestellungen:", error);
                document.getElementById("orderTableContainer").innerHTML = "<p>‚ùå Fehler beim Laden der Daten.</p>";
            });
    </script>

</body>

</html>